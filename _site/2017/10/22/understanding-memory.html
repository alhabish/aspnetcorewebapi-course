<!doctype html>
<html dir="rtl" lang="ar-SA">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

<!-- Begin Jekyll SEO tag v2.3.0 -->
<title>التعامل مع الذاكرة Understanding Memory | لنتعلم برمجة الأنظمة المدمجة</title>
<meta property="og:title" content="التعامل مع الذاكرة Understanding Memory" />
<meta name="author" content="خالد الغامدي" />
<meta property="og:locale" content="ar_SA" />
<meta name="description" content="يوجد لدينا عدة أنواع من الذاكرة على النظام، أهمها: ROM أو Flash memory ومساحتها 256KB. ومن الممكن أن يكون لدينا أكثر من ذاكرة ROM على النظام المدمج. وهذا الجزء الذي يحفظ فيه الكود code والثوابت constants. والبيانات المحفوظه في هذه الذاكره لا تمسح في حالة إعادة تشغيل المتحكم non-volotile." />
<meta property="og:description" content="يوجد لدينا عدة أنواع من الذاكرة على النظام، أهمها: ROM أو Flash memory ومساحتها 256KB. ومن الممكن أن يكون لدينا أكثر من ذاكرة ROM على النظام المدمج. وهذا الجزء الذي يحفظ فيه الكود code والثوابت constants. والبيانات المحفوظه في هذه الذاكره لا تمسح في حالة إعادة تشغيل المتحكم non-volotile." />
<link rel="canonical" href="http://localhost:4000/2017/10/22/understanding-memory.html" />
<meta property="og:url" content="http://localhost:4000/2017/10/22/understanding-memory.html" />
<meta property="og:site_name" content="لنتعلم برمجة الأنظمة المدمجة" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-10-22T00:00:00+03:00" />
<script type="application/ld+json">
{"name":null,"description":"يوجد لدينا عدة أنواع من الذاكرة على النظام، أهمها: ROM أو Flash memory ومساحتها 256KB. ومن الممكن أن يكون لدينا أكثر من ذاكرة ROM على النظام المدمج. وهذا الجزء الذي يحفظ فيه الكود code والثوابت constants. والبيانات المحفوظه في هذه الذاكره لا تمسح في حالة إعادة تشغيل المتحكم non-volotile.","author":{"@type":"Person","name":"خالد الغامدي"},"@type":"BlogPosting","url":"http://localhost:4000/2017/10/22/understanding-memory.html","publisher":null,"image":null,"headline":"التعامل مع الذاكرة Understanding Memory","dateModified":"2017-10-22T00:00:00+03:00","datePublished":"2017-10-22T00:00:00+03:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2017/10/22/understanding-memory.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script type="text/javascript" src="/assets/js/jquery-1.12.4.min.js" ></script>
    <script type="text/javascript" src="/assets/js/main.js"></script>
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>لنتعلم برمجة الأنظمة المدمجة</h1>
		<h3 text-align="left">Embedded Systems Programming Bootcamp</h3>
        <p>كورس تعليمي يهدف الى اكسابك المعرفة اللازمة والمهارات التقنية المتعلقة ببرمجة وتطوير الأنظمة المدمجة وفهم خصائصها ومكوناتها</p>
        <p class="view">
            <a href="/">الصفحة الرئيسية</a><br>
            <!--<a href="/#contents">الدروس</a><br>-->
            <a href="/lessons.html">قائمة الدروس</a><br>
            <a href="/feed.xml" title="Subscribe to our RSS feed">خدمة RSS</a>
        </p>
        <!--/assets/images/sidebar/rss.svg-->
          <!--<aside>-->
    <h3>للتواصل</h3>
    <ul class="social">
    <li><a href="https://github.com/alhabish/embedded-course" title="Github" class="github">Github</a></li>
    <li><a href="mailto:alhabish@gmail.com" title="Email" class="mail">Email</a></li>
    <li><a href="https://www.linkedin.com/in/khalidalghamidi" title="Linked in" class="linked">LinkedIn</a></li>
    <li><a href="http://www.twitter.com/alhabish" title="Twitter" class="twitter">Twitter</a></li>
    </ul>
    <!--</aside>-->
          
<!--        
        

        

        
-->
      </header>
      <section>

      <h1>5. التعامل مع الذاكرة  Understanding Memory</h1>
<p class="meta">2017-10-22</p>


<!-- from https://github.com/cstack/db_tutorial -->


      
      

    <hr>
      
          <a class="prev" href="/2017/11/02/ports-and-pins.html">6. المنافذ والأطراف  Ports & Pins</a> <br>
      
      
          <a class="next" href="/2017/10/16/board-and-micro.html">4. المتحكم والبورد  Board & Microcontroller</a> <br>
      
    <br>
    <hr>

    <p><p>يوجد لدينا عدة أنواع من الذاكرة على النظام، أهمها:</p>
<ul>
  <li>
    <p><strong>ROM</strong> أو Flash memory ومساحتها 256KB. ومن الممكن أن يكون لدينا أكثر من ذاكرة ROM على النظام المدمج. وهذا الجزء الذي يحفظ فيه الكود code والثوابت constants. والبيانات المحفوظه في هذه الذاكره لا تمسح في حالة إعادة تشغيل المتحكم non-volotile.</p>
  </li>
  <li>
    <p><strong>RAM</strong> ومساحتها 32KB. وهنا تحفظ البيانات data او المتغيرات variables أثناء عمل برنامجنا بالإضافة الى الـ stack. والبيانات في هذا النوع من الذاكرة تفقد في حالة إعادة تشغيل المتحكم volotile.</p>
  </li>
  <li>
    <p><strong>I/O Ports</strong> نشير الى أطراف الـ Input/Output بطريقة تسمى memory mapped IO وهي تعني أنه عندما نريد أن نتعامل مع منفذ IO فإنه كل الذي علينا عمله هو قرائة أو كتابة مكان مخصص في الذاكرة كل bit فيها يشير الى طرف pin في المنفذ.</p>
  </li>
</ul>

<table style="border: 1px solid #CACFD2">
<caption align="bottom">Memory Map</caption>

<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_05/mmap.png" alt="Memory Map" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_05/mmap.png');" />
    </td>
</tr>
</table>

<p>نلاحظ وجود بعض الفراغات بين الأنواع المختلفة للذاكرة وهي غير مستخدمة ولا يمكن الإشارة اليها ومن الخطأ القيام بذلك.</p>

<p>ولمزيد من التفاصيل حول الأجزاء المختلفة للذاكرة فإنه يمكن العودة الى جزئية الـ memory model في دليل البيانات data sheet ص 92.</p>

<p>ومن الجميل جداً أنه من الممكن التعامل مع هذه الأنواع المختلفه من الذاكرة كجدول موحد والرجوع الى كل منها حسب عنوان 32bit address. وفيما يلي عناوين الذاكرة:</p>
<ul>
  <li><strong>ROM</strong> من 0x00000000 الى 0x0003FFFF</li>
  <li><strong>RAM</strong> من 0x20000000 الى 0x20007FFF</li>
  <li><strong>I/O Ports</strong> من 0x40000000 الى 0x400FFFFF</li>
</ul>

<p>تجدر الإشارة الى أنه من المتعارف عليه التعبير عن عناوين الذاكرة بالأعداد الست عشرية hexadecimal numbers بدلاً من الأعداد العشرية decimal numbers وأحد أسباب ذلك هو للإختصار. فبدلاً من القول بأن الذاكرة تبدأ من العنوان 536870912 كعدد عشري، فمن الأوضح والمختصر القول بأنها تبدأ من العدد الست عشري 0x20000000.</p>

<h2><a href=""></a>طريقة حساب حجم الذاكرة</h2>
<p>لو أخذنا ذاكرة الـ RAM على سبيل المثال، فقد قلنا أن حجمها 32KB، فكيف توصلنا الى هذه النتيجة؟ يمكن معرفة حجم الذاكرة اذا توفر لديك عنواني البداية والنهاية بإتباع المعادلة البسيطة التالية:</p>

<blockquote class="rule">
<p>((عنوان النهاية  -  عنوان البداية) /  1024)  +  1  =  ؟؟  كيلوبايت</p>
</blockquote>

<p>مع ملاحظة أنه تم القسمة على 1024 للتحويل من بايت byte الى كيلوبايت kilobyte حيث أن التحويل بين الأحجام يكون كما يلي:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>1 KB = 2^10 bytes = 1024 bytes
1 MB = 2^20 bytes = 1,048,576 bytes
1 GB = 2^30 bytes = 1,073,741,824 bytes
</code></pre>
</div>

<p>وكما ذكرنا سابقاً، فإن عنوان الـ RAM يبدأ من 0x20000000 وينتهي في 0x20007FFF، وبالتعويض في القاعدة تصبح:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>((0x20007FFF - 0x20000000) / 1024) + 1 = ?
</code></pre>
</div>
<p>ومن الممكن إستخدام الآلة الحاسبة في ويندوز للقيام بالعمليات الحسابية على الأعداد الست عشرية بفتح خصائص الآلة الحاسبة وإختيار نمط المبرمج Programmer كما يلي:</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_05/calc1.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_05/calc1.png');" />
    </td>
</tr>
</table>

<p>ثم الضغط على الصف الذي يحتوي على عبارة Hex:</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_05/calc2.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_05/calc2.png');" />
    </td>
</tr>
</table>

<p>وقم بالعملية الحسابية على الأعداد الست عشرية بدون إضافة 0x في المقدمة:</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_05/calc3.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_05/calc3.png');" />
    </td>
</tr>
</table>

<p>ستظهر لك النتيجة التالية:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>7FFF
</code></pre>
</div>

<p>اضغط الآن على الصف الذي يحتوي على عبارة DEC لنتعامل مع التمثيل العشري للعدد الناتج:</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_05/calc4.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_05/calc4.png');" />
    </td>
</tr>
</table>

<p>هذه النتيجه بالبايت byte، لتحولها الى كيلوبايت kilobyte قُم بالقسمة على 1024 ليصبح الناتج 31، ثم نضيف بعد ذلك 1 لتصبح 32 وبذلك نجد أن مساحة ذاكرة الـ ROM تساوي 32 كيلوبايت.</p>

<h2><a href=""></a>التعامل مع الذاكرة</h2>

<p>مختلف عناوين الذاكرة التي يمكن التعامل معها تسمى address space وفي معمارية الـ  ARM Cortex-M نشير اليها بإستخدام 32bits تبدأ من 0x00000000 وتنتهي في 0xFFFFFFFF بما مجموعه 4GB.</p>

<p>فلو أردنا مثلاً التعامل مع العنوان التالي في الذاكرة 0x20000004 وهو جزء من الذاكرة العشوائية RAM، فإن طريقة الإشارة اليها بلغة الـ C يكون بإستخدام مؤشر pointer كما يلي:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>unsigned long *p = (unsigned long *)0x20000004U;
</code></pre>
</div>

<p>وكان من اللازم علينا إضافة <strong>(* unsigned long)</strong> ، وهذه الطريقة تسمى type casting، وإلا فإن المترجم compiler سيعتبرها رقماً عاديا وليس عنواناً في الذاكرة. وأضفنا <strong>U</strong>  في نهاية العنوان لأن عناوين الذاكرة من نوع unsigned integer.</p>

<p>وتجدر الإشارة الى أن الـ long في معمارية الـ ARM Cortex-M عبارة عن 32bit integer وكان بالإمكان إستخدام int بدلاً منها حيث أنها هي ايضا 32bit ولكن ينصح بعدم القيام بذلك حيث أنه ليس من المؤكد لو أخترت مترجم compiler مختلف عن الـ Keil compiler الذي نستخدمه أنه سيقوم بتمثيل الـ int بـ 32bit.</p>

<p>ولو أردت أن تتأكد بأن المؤشر p فعلاً يشير الى العنوان المسند اليه فإنه بإمكانك إستخدام الكود التالي:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>printf ("%p", p);
</code></pre>
</div>

<p>وإذا أردنا إسناد قيمة لمكان الذاكرة الذي يشير اليه المؤشر نقول:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>*p = 0xCAFED00D; // hexadecimal number, or
*p = 3405697037; // decimal number, or
*p = 0b11001010111111101101000000001101; // binary number
</code></pre>
</div>
<p>وللوصول الى القيمة التي يشير اليها المؤشر فإننا نقوم بعملية derefrencing للمؤشر كما يلي:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>printf ("%d", *p);
</code></pre>
</div>
</p>

    <blockquote class="post_ending_note">
        <p><strong>ملاحظة</strong>: هذه المقالة تحت التحديث المستمر،، وملاحظاتكم وإقتراحاتكم ستساعد بإذن الله في إخراجها بالصورة التي كتبت من أجلها وهي تمهيد الطريق أمامكم لتعلم برمجة الأنظمة المدمجة </p>
    </blockquote>

    <hr>
      
          <a class="prev" href="/2017/11/02/ports-and-pins.html">6. المنافذ والأطراف  Ports & Pins</a> <br>
      
      
          <a class="next" href="/2017/10/16/board-and-micro.html">4. المتحكم والبورد  Board & Microcontroller</a> <br>
      
    <br>
    <hr>

<br>




<div id="disqus_thread"></div>
<script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
this.page.url = "http://localhost:4000/2017/10/22/understanding-memory.html";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = "/2017/10/22/understanding-memory"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://embedded-course.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            


      </section>
<!--      
      <footer>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
-->
    </div>
    <script src="/assets/js/scale.fix.js"></script>
    <!--<script type="text/javascript" src="/assets/js/staticman.js"></script>-->

  
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-106571814-1', 'auto');
        ga('send', 'pageview');
    </script>
  
  </body>
</html>
