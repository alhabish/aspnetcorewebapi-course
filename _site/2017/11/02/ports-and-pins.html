<!doctype html>
<html dir="rtl" lang="ar-SA">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

<!-- Begin Jekyll SEO tag v2.3.0 -->
<title>المنافذ والأطراف Ports &amp; Pins | لنتعلم برمجة الأنظمة المدمجة</title>
<meta property="og:title" content="المنافذ والأطراف Ports &amp; Pins" />
<meta name="author" content="خالد الغامدي" />
<meta property="og:locale" content="ar_SA" />
<meta name="description" content="للمتحكم TM4C123GH6PM الموجود على البورد 43 طرف pin متعدد الإستعمال تسمى بالـ General-purpose input/output GPIO pins. وليسهل التعامل معها فإنها موزعة على 6 منافذ ports كما يلي:" />
<meta property="og:description" content="للمتحكم TM4C123GH6PM الموجود على البورد 43 طرف pin متعدد الإستعمال تسمى بالـ General-purpose input/output GPIO pins. وليسهل التعامل معها فإنها موزعة على 6 منافذ ports كما يلي:" />
<link rel="canonical" href="http://localhost:4000/2017/11/02/ports-and-pins.html" />
<meta property="og:url" content="http://localhost:4000/2017/11/02/ports-and-pins.html" />
<meta property="og:site_name" content="لنتعلم برمجة الأنظمة المدمجة" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-11-02T00:00:00+03:00" />
<script type="application/ld+json">
{"name":null,"description":"للمتحكم TM4C123GH6PM الموجود على البورد 43 طرف pin متعدد الإستعمال تسمى بالـ General-purpose input/output GPIO pins. وليسهل التعامل معها فإنها موزعة على 6 منافذ ports كما يلي:","author":{"@type":"Person","name":"خالد الغامدي"},"@type":"BlogPosting","url":"http://localhost:4000/2017/11/02/ports-and-pins.html","publisher":null,"image":null,"headline":"المنافذ والأطراف Ports &amp; Pins","dateModified":"2017-11-02T00:00:00+03:00","datePublished":"2017-11-02T00:00:00+03:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2017/11/02/ports-and-pins.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script type="text/javascript" src="/assets/js/jquery-1.12.4.min.js" ></script>
    <script type="text/javascript" src="/assets/js/main.js"></script>
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>لنتعلم برمجة الأنظمة المدمجة</h1>
		<h3 text-align="left">Embedded Systems Programming Bootcamp</h3>
        <p>كورس تعليمي يهدف الى اكسابك المعرفة اللازمة والمهارات التقنية المتعلقة ببرمجة وتطوير الأنظمة المدمجة وفهم خصائصها ومكوناتها</p>
        <p class="view">
            <a href="/">الصفحة الرئيسية</a><br>
            <!--<a href="/#contents">الدروس</a><br>-->
            <a href="/lessons.html">قائمة الدروس</a><br>
            <a href="/feed.xml" title="Subscribe to our RSS feed">خدمة RSS</a>
        </p>
        <!--/assets/images/sidebar/rss.svg-->
          <!--<aside>-->
    <h3>للتواصل</h3>
    <ul class="social">
    <li><a href="https://github.com/alhabish/embedded-course" title="Github" class="github">Github</a></li>
    <li><a href="mailto:alhabish@gmail.com" title="Email" class="mail">Email</a></li>
    <li><a href="https://www.linkedin.com/in/khalidalghamidi" title="Linked in" class="linked">LinkedIn</a></li>
    <li><a href="http://www.twitter.com/alhabish" title="Twitter" class="twitter">Twitter</a></li>
    </ul>
    <!--</aside>-->
          
<!--        
        

        

        
-->
      </header>
      <section>

      <h1>6. المنافذ والأطراف  Ports & Pins</h1>
<p class="meta">2017-11-02</p>


<!-- from https://github.com/cstack/db_tutorial -->


      
      

    <hr>
      
          <a class="prev" href="/2017/11/06/rgb-led-blinking.html">7. برنامج لوميض الإضاءة الملونة  RGB LED Blinking</a> <br>
      
      
          <a class="next" href="/2017/10/22/understanding-memory.html">5. التعامل مع الذاكرة  Understanding Memory</a> <br>
      
    <br>
    <hr>

    <p><p>للمتحكم TM4C123GH6PM الموجود على البورد 43 طرف pin متعدد الإستعمال تسمى بالـ General-purpose input/output GPIO pins. وليسهل التعامل معها فإنها موزعة على 6 منافذ ports كما يلي:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">المنفذ</th>
      <th style="text-align: right">عدد الأطراف</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right"><strong>PORT A</strong></td>
      <td style="text-align: right">8</td>
    </tr>
    <tr>
      <td style="text-align: right"><strong>PORT B</strong></td>
      <td style="text-align: right">8</td>
    </tr>
    <tr>
      <td style="text-align: right"><strong>PORT C</strong></td>
      <td style="text-align: right">8</td>
    </tr>
    <tr>
      <td style="text-align: right"><strong>PORT D</strong></td>
      <td style="text-align: right">8</td>
    </tr>
    <tr>
      <td style="text-align: right"><strong>PORT E</strong></td>
      <td style="text-align: right">6</td>
    </tr>
    <tr>
      <td style="text-align: right"><strong>PORT F</strong></td>
      <td style="text-align: right">5</td>
    </tr>
  </tbody>
</table>

<blockquote class="note">
<p>
<u>ملاحظة</u>،  <strong>Port C</strong> لديه 8 أطراف لكننا لن نستخدم الأطراف التالية:
<strong>PC0, PC1, PC2, PC3</strong>
حيث أنها محجوزة للـ debugger ولذلك فإننا فعلياً نستخدم 4 أطراف فقط في هذا المنفذ.
</p>
</blockquote>

<p>وبذلك يكون لدينا 43 طرف يمكن برمجتها ولكن 4 منها محجوز كما ذكرنا في الملاحظة السابقة، أي فعلياً هنالك 39 طرف يمكننا التعامل معها وبرمجتها.</p>

<p>هذه الأطراف يمكن إستخدامها كمدخل للبيانات input حيث تمكننا من إستقبال معلومات من البيئة المحيطة. أو كمخرج للبيانات output حيث تمكننا من ارسال معلومات لما قد يحيط بها أو يحتويها.</p>

<p>وفي الفصل 22 من دليل البيانات datasheet (ص 1328) نجد الرسم التخطيطي للمنافذ والأطراف في المتحكم:</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_06/pin_diagram.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_06/pin_diagram.png');" />
    </td>
</tr>
</table>

<p>وها هو المتحكم على البورد حيث نستطيع أن نرى أطراف المتحكم (داخل المستطيلات الخضراء) تتصل بأطراف البورد (وهي بداخل المستطيلات الصفراء) عن طريق مسارات buses لنقل البيانات (باللون البرتقالي):</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_06/tivac_board_pins_and_ports.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_06/tivac_board_pins_and_ports.png');" />
    </td>
</tr>
</table>

<p>وتمكننا الأطراف التي على البورد من ربط البورد (وبالتالي المتحكم) بأجزاء الكترونية أخرى من ضمنها لوح التجارب breadboard حيث يمكن ربطها بأسلاك سواء من الـ male headers أعلى البورد أو الـ female headers أسفل البورد.</p>

<hr />

<h2><a href=""></a>عناوين المنافذ في الذاكرة على المسار APB</h2>

<p>يوجد مسارين لنقل البيانات المتعلقة بالـ Input/Output ports وهي:</p>
<ul>
  <li>Advanced Peripheral Bus - <strong>APB</strong></li>
  <li>Advanced High-Performance Bus - <strong>AHB</strong></li>
</ul>

<p>المسار الثاني يعتبر الأفضل أداء والأسرع والأول أفضل من ناحية توفير الطاقة وهو الذي سيتم إستخدامه في هذا الكورس بإذن الله.</p>

<p>لكل منفذ مساحة 4kbyte من الذاكرة تحتوي على سجلات registers عديدة للتحكم بالمنفذ، ومن ضمنها السجل المتعلق بتحديد وظيفة أو إتجاه كل طرف في المنفذ Direction Register والسجل الخاص بالقراءة والكتابة من والى المنفذ Data Register بالإضافة الى غيرها من السجلات المتعلقة بالمنفذ.</p>

<p>وفيما يلي عناوين المنافذ في الذاكرة على المسار APB من الأصغر الى الأكبر، علماً أن عنوان البداية لكل منفذ يسمى الـ base address لذلك المنفذ:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">المنفذ</th>
      <th style="text-align: right">يبدأ من</th>
      <th style="text-align: right">ينتهي في</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right"><strong>PORT A</strong></td>
      <td style="text-align: right">0x4000.4000</td>
      <td style="text-align: right">0x4000.4FFF</td>
    </tr>
    <tr>
      <td style="text-align: right"><strong>PORT B</strong></td>
      <td style="text-align: right">0x4000.5000</td>
      <td style="text-align: right">0x4000.5FFF</td>
    </tr>
    <tr>
      <td style="text-align: right"><strong>PORT C</strong></td>
      <td style="text-align: right">0x4000.6000</td>
      <td style="text-align: right">0x4000.6FFF</td>
    </tr>
    <tr>
      <td style="text-align: right"><strong>PORT D</strong></td>
      <td style="text-align: right">0x4000.7000</td>
      <td style="text-align: right">0x4000.7FFF</td>
    </tr>
    <tr>
      <td style="text-align: right"><strong>PORT E</strong></td>
      <td style="text-align: right">0x4002.4000</td>
      <td style="text-align: right">0x4002.4FFF</td>
    </tr>
    <tr>
      <td style="text-align: right"><strong>PORT F</strong></td>
      <td style="text-align: right">0x4002.5FFF</td>
      <td style="text-align: right">0x4002.5000</td>
    </tr>
  </tbody>
</table>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_06/gpio_memory_map.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_06/gpio_memory_map.png');" />
    </td>
</tr>
</table>

<hr />

<h2><a href=""></a>طريقة التعامل مع عناوين الذاكرة</h2>

<p>لو أفترضنا أننا أردنا التعامل مع العنوان التالي في الذاكرة:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>0x400253FC
</code></pre>
</div>

<p>فلو حاولنا إسناده الى متغير في لغة الـ C فإنه سيعتبر رقماً عادياً لا أكثر. ولجعل الـ C تعتبره عنواناً في الذاكرة فإننا نقوم بعملية derefrencing:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(*0x400253FC)
</code></pre>
</div>
<p>ولكن في هذه الحالة لن يعرف المجمع compiler كم بت bit عليه أن يقرأ من موقع الذاكرة المشار اليه. هل يقرأ 8 بت أو 16 بت أو 32 بت؟ ولذلك نقوم بتحويل القيمة casting اما لـ long أو int حيث أنه لا فرق بينهما في معمارية الـ ARM Cortex-M فكلاهما يتكون من 32 بت.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(long *)0x400253FC
</code></pre>
</div>
<p>وبما أن القيّم في سجلات الـ GPIO لا تحمل إشارة unsigned بمعنى أنها لا يمكن أن تكون بالسالب، فإننا نضيف عبارة unsigned على جزئية الـ casting:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(unsigned long *)0x400253FC
</code></pre>
</div>

<p>أيضاً، بما إن القيّم في السجلات ممكن أن تتغير من خارج الكود الذي نقوم بكتابته، فعلى سبيل المثال، لو قام المستخدم بالضغط على الزر Switch 1 فستتغير قيمة البت المقابلة في المتحكم من 1 الى 0، وهذا التغيير حدث خارج إطار الكود الذي قمنا بكتابته. ولهذا السبب فإننا سنطلب من المجمع compiler قراءة القيمة الجديدة دوماً وليس الإعتماد على قيمة مخزنة مسبقاً بسبب الـ compiler optimization. ويكون ذلك بإستخدام عبارة volatile:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(volatile unsigned long *)0x400253FC
</code></pre>
</div>

<p>وبما أننا نريد قيمة السجل وليس العنوان فإننا نقوم بعملية الـ derefrencing بإستخدام النجمة * وإستخدام الماكرو define# لإسناد قيمة السجل الى إسم من عندنا:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#define GPIOF_DATA   (*((volatile unsigned long *)0x400253FC))
</code></pre>
</div>

<hr />

<h2><a href=""></a>خطوات التعامل مع أطراف الـ GPIO</h2>

<p>الخطوات الرئيسية للتعامل مع الأطراف هي بتعديل السجلات التالية:</p>

<h3><a href=""></a>1. تفعيل المنفذ</h3>

<p>ويتم ذلك عبر سجل المؤقت RCGCGPIO، ومن دون هذه الخطوة فإنه من غير الممكن التعامل مع المنفذ المطلوب.
ومن أجل توفير الطاقة، فإن الـ ARM Cortex-M لا تفعّل المنافذ منذ البداية وهذه التقنية تسمى clock gating، بل يجب عليك القيام بذلك بنفسك وذلك عن طريق تفعيل المؤقت الخاص بالمنفذ المطلوب. وبالنظر الى دليل البيانات (ص 340)، نجد شرح لهذا السجل:</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_06/rcgcgpio.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_06/rcgcgpio.png');" />
    </td>
</tr>
</table>

<p>ولتفعيل المنافذ فإننا نتعامل مع الـ bits التالية:</p>

<ul>
  <li>bit 0 تفعيل/الغاء تفعيل المنفذ  Port A</li>
  <li>bit 1 تفعبل/الغاء تفعيل المنفذ  Port B</li>
  <li>bit 2 تفعبل/الغاء تفعيل المنفذ  Port C</li>
  <li>bit 3 تفعبل/الغاء تفعيل المنفذ  Port D</li>
  <li>bit 4 تفعبل/الغاء تفعيل المنفذ  Port E</li>
  <li>bit 5 تفعبل/الغاء تفعيل المنفذ  Port F</li>
</ul>

<p>ويكون التفعيل بكتابة 1 الى البت bit المطلوب، وعدم التفعيل بكتابة 0 الى تلك الـ bit.</p>

<p>للتعامل مع هذا السجل، ولكي يصبح لديك عنواناً كاملاً، فإنه يتوجب علينا إضافة القيمة التي يبعدها السجل Offset عن العنوان الرئيسي للمنفذ Base address الى ذلك العنوان الرئيسي للحصول على العنوان الكامل للسجل:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Base 0x400F.E000
Offset 0x608
</code></pre>
</div>

<p>وبذلك يكون عنوان هذا السجل register:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#define SYSCTL_RCGCGPIO_R   (*((volatile unsigned long *)0x400FE608))
</code></pre>
</div>

<h3><a href=""></a>2. تحديد وظيفة الأطراف (الإتجاه) مدخلات/مخرجات</h3>

<p>وذلك بواسطة السجل GPIODIR (ص 663 في دليل البيانات) حيث يمكننا تحديد ما اذا كان الطرف للقراءة input او الكتابة output.</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_06/gpiodir.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_06/gpiodir.png');" />
    </td>
</tr>
</table>

<p>ومثل ما ذكرنا سابقاً، فإننا سنستخدم المسار APB للتعامل مع الـ GPIO ولذلك سنستخدم العناوين في الذاكرة التي توضح ذلك. وفيما يخص سجل الـ GPIODIR فإنه يبعد 0x400 عن العناوين السابقة offset. وبذلك يكون السجل المستخدم لكل منفذ كما يلي:</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_06/gpiodir_apb_offset.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_06/gpiodir_apb_offset.png');" />
    </td>
</tr>
</table>

<div class="highlighter-rouge"><pre class="highlight"><code>#define GPIO_PORTA_DIR_R   (*((volatile unsigned long *)0x40004400))
#define GPIO_PORTB_DIR_R   (*((volatile unsigned long *)0x40005400))
#define GPIO_PORTC_DIR_R   (*((volatile unsigned long *)0x40006400))
#define GPIO_PORTD_DIR_R   (*((volatile unsigned long *)0x40007400))
#define GPIO_PORTE_DIR_R   (*((volatile unsigned long *)0x40024400))
#define GPIO_PORTF_DIR_R   (*((volatile unsigned long *)0x40025400))
</code></pre>
</div>
<p>وللتحكم بالأطراف في هذه المنافذ فإننا نتعامل مع الـ bits التالية:</p>

<ul>
  <li>bit 0 لتحديد اتجاه الطرف pin 0 في المنفذ port المطلوب</li>
  <li>bit 1 لتحديد اتجاه الطرف pin 1 في المنفذ port المطلوب</li>
  <li>bit 2 لتحديد اتجاه الطرف pin 2 في المنفذ port المطلوب</li>
  <li>bit 3 لتحديد اتجاه الطرف pin 3 في المنفذ port المطلوب</li>
  <li>bit 4 لتحديد اتجاه الطرف pin 4 في المنفذ port المطلوب</li>
  <li>bit 5 لتحديد اتجاه الطرف pin 5 في المنفذ port المطلوب</li>
  <li>bit 6 لتحديد اتجاه الطرف pin 6 في المنفذ port المطلوب</li>
  <li>bit 7 لتحديد اتجاه الطرف pin 7 في المنفذ port المطلوب</li>
</ul>

<p>بكتابة 1 الى البت سيجعل الطرف الذي تتحكم به للكتابة output، وكتابة 0 سيجعل ذلك الطرف للقراءة. علماً أنه جميع الأطراف معدة لتكون للقراءة input مالم يتم تعيينها للكتابة output.</p>

<h3><a href=""></a>3. تفعيل الطرف</h3>

<p>وذلك عن طريق السجل GPIODEN والذي يستخدم لتحديد ما إذا كان الطرف يستخدم للقراءة والكتابة الرقمية digital I/O أو للوظائف التماثلية analog الأخرى حيث أنه بإمكان كل طرف أن يكون له أكثر من وظيفة وهو ما يسمى بـ pin multiplexing وإلا فإننا سنحتاج الى مئات من الأطراف للقيام بجميع المهام. وبإمكان الطرف أن يستخدم للقراءة الرقمية digital I/O أو التماثلية analog او بروتوكولات التواصل مثل I2C أو UART أو SPI أو غيرها. ومن ص 683 في دليل البيانات يتضح لنا:</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_06/gpioden.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_06/gpioden.png');" />
    </td>
</tr>
</table>

<p>نلاحظ ان السجل يبعد عن العنوان الرئيسي للمنفذ offset بمقدار 0x51C. وبعد إضافتها للعنوان الرئيسي لكل منفذ تصبح العناوين كما يلي:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#define GPIO_PORTA_DEN_R   (*((volatile unsigned long *)0x4000451C))
#define GPIO_PORTB_DEN_R   (*((volatile unsigned long *)0x4000551C))
#define GPIO_PORTC_DEN_R   (*((volatile unsigned long *)0x4000651C))
#define GPIO_PORTD_DEN_R   (*((volatile unsigned long *)0x4000751C))
#define GPIO_PORTE_DEN_R   (*((volatile unsigned long *)0x4002451C))
#define GPIO_PORTF_DEN_R   (*((volatile unsigned long *)0x4002551C))
</code></pre>
</div>

<p>وعند كتابة 1 للبت المقابل للمنفذ فإنه يتم تفعيل الخصائص الرقمية digital للطرف، وعند كتابة 0 فإنه يتم تفعيل الخصائص التماثلية analog للطرف.</p>

<h3><a href=""></a>4. الكتابة أو القرائة من الطرف</h3>

<p>ويتم ذلك عن طريق سجل GPIODATA. ففي الطرفيات المخصصة للكتابة output فإنه يمكن تشغيل الطرف وجعله high بإرسال القيمة 1 اليه، وإذا ما أردنا إطفائه low فإننا نرسل له القيمة 0. وفي الأطراف المخصصه للقراءة input فإنه يمكن قراءة البت bit المقابلة للطرف لمعرفة اذا ماتم تفعيلها أم لا. وفي ص 662 من دليل البيانات نرى:</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_06/gpiodata.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_06/gpiodata.png');" />
    </td>
</tr>
</table>

<p>وصف السجل يخبرنا بأن الـ offset 0x000 ولكن هذا لإستخدام تقنية تسمى bit banding وهي تحجز لنا مكان في الذاكرة يتسع للتعامل مع كل طرف (أو بت) على حده ولكننا نريد التعديل على الـبتات الثمانية 8 bits، التي تقابل الأطراف في المنافذ، مرة واحدة. وللقيام بذلك فإننا نستخدم offset 0x3FC فتصبح لدينا العناوين:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#define GPIO_PORTA_DATA_R   (*((volatile unsigned long *)0x400043FC))
#define GPIO_PORTB_DATA_R   (*((volatile unsigned long *)0x400053FC))
#define GPIO_PORTC_DATA_R   (*((volatile unsigned long *)0x400063FC))
#define GPIO_PORTD_DATA_R   (*((volatile unsigned long *)0x400073FC))
#define GPIO_PORTE_DATA_R   (*((volatile unsigned long *)0x400243FC))
#define GPIO_PORTF_DATA_R   (*((volatile unsigned long *)0x400253FC))
</code></pre>
</div>

<blockquote class="note">
<p>
جميع السجلات عبارة عن 32 بت (4 بايت) ما عدا <strong>GPIODATA</strong> حيث أنها مجموعة من السجلات تتكون من 256 سجل وكل سجل منها يتكون من 4 بايت أيضاً بما مجموعه 1024 بايت. ولكن الذي يهمنا الآن هو السجل بالعنوان الذي يحتوي على offset 0x3FC
</p>
</blockquote>

<hr />

<h2><a href=""></a>طريقة أخرى للإشارة الى الذاكرة</h2>

<p>بدلاً من حساب موقع السجل ومن ثم كتابته كما يلي:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#define GPIO_PORTF_DATA_R   (*((volatile unsigned long *)0x400253FC))
</code></pre>
</div>

<p>فإنه بإمكاننا إضافة العنوان الرئيسي base address للمنفذ الى الـ offset للسجل المطلوب:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#define GPIO_PORTF_BASE   0x40025000
#define GPIO_PORTF_DATA   (*((volatile unsigned long *)(GPIO_PORTF_BASE + 0x3FC)))
#define GPIO_PORTF_DIR    (*((volatile unsigned long *)(GPIO_PORTF_BASE + 0x400)))
#define GPIO_PORTF_DEN    (*((volatile unsigned long *)(GPIO_PORTF_BASE + 0x51C)))
</code></pre>
</div>

<p>وميزة هذه الطريقة إنها أوضح وتجعل عملية حساب العناوين أقل عرضة للخطأ ويمكن نسخ ما سبق لباقي المنافذ الأخرى مع تغيير الـ base address لكل منفذ بالإضافة الى تغيير إسم المنفذ، فبدلاً من F نغيره الى A, B, C … الخ.</p>

<hr />

<h2><a href=""></a>للعمل على المسار AHB بدلاً من APB</h2>

<p>إذا ما أردت أن تتعامل مع المسار AHB وهو الأحدث والأكثر كفائة، فكل ما عليك هو كتابة قيمة معينة الى السجل GPIOHBCTL (ص 258 في دليل البيانات) ثم إستخدام عناوين الـ AHB بدلاً من APB التي أستخدمناها سابقاً. علماً أنه بالإمكان أن يكون لديك بعض المنافذ تستخدم المسار APB وبعضها يستخدم AHB أو جميعها تستخم نفس المسار، الأمر عائد اليك.</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_06/gpiohbctl.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_06/gpiohbctl.png');" />
    </td>
</tr>
</table>

<div class="highlighter-rouge"><pre class="highlight"><code>#define SYSCTL_GPIOHBCTL_R   (*((volatile unsigned long *)0x400FE06C))
</code></pre>
</div>

<p>اذا أردت أن تجعل المنفذ F يستخدم المسار AHB على سبيل المثال، فبالعودة الى شرح السجل في دليل البيانات نجد أنه كل ماعليك فعله هو كتابة 1 في البت 5 في السجل، كما يلي:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SYSCTL_GPIOHBCTL_R |= 0x20; // 0001 0000, or
SYSCTL_GPIOHBCTL_R |= (1U &lt;&lt; 5); // 0001 0000 
</code></pre>
</div>

<hr />
</p>

    <blockquote class="post_ending_note">
        <p><strong>ملاحظة</strong>: هذه المقالة تحت التحديث المستمر،، وملاحظاتكم وإقتراحاتكم ستساعد بإذن الله في إخراجها بالصورة التي كتبت من أجلها وهي تمهيد الطريق أمامكم لتعلم برمجة الأنظمة المدمجة </p>
    </blockquote>

    <hr>
      
          <a class="prev" href="/2017/11/06/rgb-led-blinking.html">7. برنامج لوميض الإضاءة الملونة  RGB LED Blinking</a> <br>
      
      
          <a class="next" href="/2017/10/22/understanding-memory.html">5. التعامل مع الذاكرة  Understanding Memory</a> <br>
      
    <br>
    <hr>

<br>




<div id="disqus_thread"></div>
<script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
this.page.url = "http://localhost:4000/2017/11/02/ports-and-pins.html";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = "/2017/11/02/ports-and-pins"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://embedded-course.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            


      </section>
<!--      
      <footer>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
-->
    </div>
    <script src="/assets/js/scale.fix.js"></script>
    <!--<script type="text/javascript" src="/assets/js/staticman.js"></script>-->

  
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-106571814-1', 'auto');
        ga('send', 'pageview');
    </script>
  
  </body>
</html>
