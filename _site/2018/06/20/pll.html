<!doctype html>
<html dir="rtl" lang="ar-SA">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

<!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Phased Lock Loop - PLL | لنتعلم برمجة الأنظمة المدمجة</title>
<meta property="og:title" content="Phased Lock Loop - PLL" />
<meta name="author" content="خالد الغامدي" />
<meta property="og:locale" content="ar_SA" />
<meta name="description" content="مصادر الساعة" />
<meta property="og:description" content="مصادر الساعة" />
<link rel="canonical" href="http://localhost:4000/2018/06/20/pll.html" />
<meta property="og:url" content="http://localhost:4000/2018/06/20/pll.html" />
<meta property="og:site_name" content="لنتعلم برمجة الأنظمة المدمجة" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-06-20T00:00:00+03:00" />
<script type="application/ld+json">
{"name":null,"description":"مصادر الساعة","author":{"@type":"Person","name":"خالد الغامدي"},"@type":"BlogPosting","url":"http://localhost:4000/2018/06/20/pll.html","publisher":null,"image":null,"headline":"Phased Lock Loop - PLL","dateModified":"2018-06-20T00:00:00+03:00","datePublished":"2018-06-20T00:00:00+03:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2018/06/20/pll.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script type="text/javascript" src="/assets/js/jquery-1.12.4.min.js" ></script>
    <script type="text/javascript" src="/assets/js/main.js"></script>
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>لنتعلم برمجة الأنظمة المدمجة</h1>
		<h3 text-align="left">Embedded Systems Programming Bootcamp</h3>
        <p>كورس تعليمي يهدف الى اكسابك المعرفة اللازمة والمهارات التقنية المتعلقة ببرمجة وتطوير الأنظمة المدمجة وفهم خصائصها ومكوناتها</p>
        <p class="view">
            <a href="/">الصفحة الرئيسية</a><br>
            <!--<a href="/#contents">الدروس</a><br>-->
            <a href="/lessons.html">قائمة الدروس</a><br>
            <a href="/feed.xml" title="Subscribe to our RSS feed">خدمة RSS</a>
        </p>
        <!--/assets/images/sidebar/rss.svg-->
          <!--<aside>-->
    <h3>للتواصل</h3>
    <ul class="social">
    <li><a href="https://github.com/alhabish/embedded-course" title="Github" class="github">Github</a></li>
    <li><a href="mailto:alhabish@gmail.com" title="Email" class="mail">Email</a></li>
    <li><a href="https://www.linkedin.com/in/khalidalghamidi" title="Linked in" class="linked">LinkedIn</a></li>
    <li><a href="http://www.twitter.com/alhabish" title="Twitter" class="twitter">Twitter</a></li>
    </ul>
    <!--</aside>-->
          
<!--        
        

        

        
-->
      </header>
      <section>

      <h1>10. Phased Lock Loop - PLL</h1>
<p class="meta">2018-06-20</p>


<!-- from https://github.com/cstack/db_tutorial -->


      
      

    <hr>
      
          <a class="prev" href="/2018/07/06/uart.html">11. بروتوكول الإتصال الغير متزامن UART</a> <br>
      
      
          <a class="next" href="/2017/11/16/systick-timer.html">9. مؤقت النظام  SysTick Timer</a> <br>
      
    <br>
    <hr>

    <p><h2><a href=""></a> مصادر الساعة</h2>

<p>توفر ساعة المتحكم النبضات اللازمة للحفاظ على تشغيل التطبيقات بطريقة متزامنة. وبالعودة الى دليل البيانات data sheet ص 222:</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_10/main_clock_tree.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_10/main_clock_tree.png');" />
    </td>
</tr>
</table>

<p>بإمكاننا أن نرى عدة مصادر للساعة ويوجد لدينا أشكال تشبه متوازي الأضلاع عبارة عن محددات أو مقسمات تحدد بعض الخصائص عن طريق التحكم في بعض البتات bits في سجلات registers معينه.</p>

<p>بإمكان نظام الساعة أن يستخدم أحد المصادر التالية:</p>

<h4><a href=""></a>1. Percision Internal Oscillator - PIOSC</h4>
<ul>
  <li>مصدر للساعة متضمن في المتحكم ويعتبر المصدر الرئيسي لساعة المتحكم بعد توصيله بالطاقة</li>
  <li>يبلغ تردده 16 ميجاهيرتز بدقة 1%</li>
  <li>بإمكانه تفعيل الـ PLL الداخلي بتردد 400 ميجاهيرتز</li>
  <li>بالإمكان إستخدامه كمؤقت للطرفيات (مثل ADC)</li>
</ul>

<h4><a href=""></a>2. Main Oscillator - MOSC</h4>
<ul>
  <li>المصدر الخارجي الرئيسي للساعة</li>
  <li>بإمكانه تفعيل الـ PLL الداخلي بتردد 400 ميجاهيرتز</li>
  <li>يوجد على البورد كرستالة بتردد 16 ميجاهيرتز مرتبطة بالمذبذب الرئيسي main oscillator</li>
</ul>

<h4><a href=""></a>3. Low Frequency Internal Oscillator - LFIOSC</h4>
<ul>
  <li>غير دقيق حيث يبلغ تردده 30 كيلوهيرتز بدقة 50%</li>
  <li>مخصص للإستخدام في حالة النوم العميق deep sleep لتوفير الطاقة</li>
  <li>يمكن أستخدامه في حالة إيقاف كلاً من PIOSC أو MOSC أو أحدهما</li>
  <li>غير مناسب للعمليات التي تحتاج الى دقة في التوقيت</li>
</ul>

<h4><a href=""></a>4. Hibernation Module Clock Source</h4>
<ul>
  <li>تسخدم كرستالة خارجية يبلغ ترددها 32.768 كيلوهيرتز</li>
  <li>بإمكانها تزويد المتحكم بتوقيت دقيق في وضعية النوم العميق (لتوفير الطاقة)</li>
</ul>

<p>مع ملاحظة أنه يجب عدم تعطيل PIOSC إلا إذا لزم الأمر، وذلك لأنه إذا تم استخدام MOSC وفشل لسبب ما، فإن PIOSC ستتولى دور توفير إشارة للساعة.</p>

<hr />
<h2><a href=""></a> Phased Lock Loop - PLL</h2>

<h3>تردد الكرستالة المستخدمة في البورد هي 16 ميجاهيرتز، ولكن بإمكان المتحكم أن يصل الى تردد 80 ميجاهيرتز كيف يكون ذلك؟</h3>

<p>ما يحدد سرعة تنفيذ المتحكم هو الكرستالة الخارجية المستخدمة والتي تبلغ في هذه البورد 16 ميجاهيرتز. لكن يوجد لدينا ما يسمى بالـ Phased Lock Loop - PLL  والتي تسمح للبرنامج بضبط سرعة الساعة وجعلها تعمل بترددات أعلى أو أقل من تردد الكرستالة. عادةً ما يتضمن اختيار التردد المفاضلة بين سرعة تنفيذ البرامج والطاقة الكهربائية المستخدمة. أي أن إبطاء الساعة يجعل من المتحكم يستهلك طاقة أقل. وتسريع الساعة يسمح بتنفيذ المزيد من العلميات في الثانية، ولكن ذلك يتطلب المزيد من الطاقة.</p>

<p>يبلغ تردد المذبذب الداخلي internal oscillator سرعة 16 ميجاهيرتز ودقة 1٪. وهو أقل دقة بكثير من الكرستالة، ولكنه يتطلب طاقة أقل ولا يحتاج إلى كرستالة خارجية. ولكن إذا كنا نرغب في التحكم الدقيق بالوقت، سنقوم بتنشيط الكرستالة الخارجية (تسمى المذبذب الرئيسي main oscillator) واستخدام PLL لتحديد السرعة المطلوبة.</p>

<p>من دون تفعيل الـ PLL، فإن المتحكم سيعمل بتردد 16 ميجاهيرتز، مما يعني أن عداد SysTick سينقص كل 62.5 نانوثانية وإذا قمنا بتنشيط الـ PLL لتشغيل المتحكم بسرعة 80 ميجا هرتز، فإن عداد SysTick سينقص كل 12.5 نانوثانية.</p>

<p>وتتراوح ترددات الـ PLL الداخلي internal PLL (على خلاف الـ USB PLL) من 3.125 ميجاهرتز إلى 80 ميجاهرتز. ويأتي المتحكم المستخدم مع PLL داخلي بتردد 400 ميجاهرتز ويقبل أي كرستالة من 5 إلى 25 ميجاهرتز. ويمكن للمذبذبات التالية أن تكون مصدراً للـ PLL:</p>

<ul>
  <li>المذبذب الداخلي الدقيق (PIOSC)</li>
  <li>المذبذب الرئيسي (MOSC)</li>
</ul>

<hr />
<h2><a href=""></a> السجلات</h2>

<h4><a href=""></a>1. <a href=""></a> Run-Mode Clock Configuration - RCC</h4>
<p>توفر عناصر التحكم بساعة النظام.</p>

<p>تفصيل هذا السجل في دليل البيانات data sheet ص 254:</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_10/rcc.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_10/rcc.png');" />
    </td>
</tr>
</table>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#define SYSCTL_RCC_R	(*((volatile unsigned long *)0x400FE060))
</span></code></pre>
</div>

<p>وما يهمنا في هذا السجل هو الحقل التالي:</p>
<ul>
  <li><strong>XTAL</strong> (من البت 6 الى 10)</li>
</ul>

<p>نحدد في هذا الحقل قيمة تردد الكرستالة المرفقة بالمذبذب الرئيسي للبورد حسب الجدول أدناه:</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_10/xtal.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_10/xtal.png');" />
    </td>
</tr>
</table>

<h4><a href=""></a>2. <a href=""></a> Run-Mode Clock Configuration 2 - RCC2</h4>
<p>توفر عناصر التحكم بساعة النظام. يستخدم سجل RCC2 لتوفير خصائص تحكم إضافية عن تلك الموجودة في سجل RCC.</p>

<p>تفصيل هذا السجل في دليل البيانات data sheet ص 260:</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_10/rcc2.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_10/rcc2.png');" />
    </td>
</tr>
</table>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#define SYSCTL_RCC2_R	(*((volatile unsigned long *)0x400FE070))
</span></code></pre>
</div>

<p>وما يهمنا في هذا السجل هو الحقول التالية:</p>

<ul>
  <li>
    <p><strong>USERCC2</strong> (البت 31)
يتم إسناد القيمة 1 الى هذا الحقل لإستخدام RCC2 وجعل قيمها تتجاوز القيم الموجودة في RCC.</p>
  </li>
  <li>
    <p><strong>BYPASS2</strong> (البت 11)
عند إسناد 0 الى هذا الحقل يتم استخدام الـ PLL وعند إسناد 1 اليه فإنه سيتم استخدام مصدر آخر للساعة.</p>
  </li>
  <li>
    <p><strong>OSCSRC2</strong> (من البت 4 الى 6)
يحدد مصدر الساعة. ومن خلال ضبط قيمة الحقل الى 0 فإنه سيتم تعيين المذبذب الرئيسي main oscillator كمصدر للساعة.</p>
  </li>
  <li>
    <p><strong>PWRDN2</strong> (البت 13)
يتم إسناد 0 الى هذا الحقل ليعمل الـ PLL بشكل طبيعي.</p>
  </li>
  <li>
    <p><strong>DIV400</strong> (البت 30)
عند إسناد 0 الى هذا الحقل يتم التعامل مع الـ PLL بتردد 200 ميجاهيرتز
وعند إسناد 1 الى هذا الحقل يتم التعامل مع الـ PLL بتردد 400 ميجاهيرتز</p>
  </li>
  <li>
    <p><strong>SYSDIV2</strong> (من البت 23 الى 28)
يمكن أن يأخذ هذا الحقل قيمة بين 4 و 127 حيث يمكن إستبدالها في المعادلة التالية لتعديل سرعة المتحكم:</p>
  </li>
</ul>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_10/bus_freq.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_10/bus_freq.png');" />
    </td>
</tr>
</table>

<p>إذا كانت SISDIV2 تساوي 4 فإن السرعة ستكون 400 مقسومة على 4 + 1 وبذلك يكون الناتج 80 ميجاهيرتز. وإذا أردنا تشغيل المتحكم بسرعة أبطأ فكل ما علينا فعله هو زيادة قيمة SISDIV2.</p>

<ul>
  <li><strong>SYSDIV2LSB</strong> (البت 22)
يعتبر بت إضافي least significant bit في حالة تم إسناد 1 الى DIV400.</li>
</ul>

<h4><a href=""></a>3. <a href=""></a> Raw Interrupt Status - RIS</h4>

<p>تفصيل هذا السجل في دليل البيانات data sheet ص 244:</p>

<table style="border: 1px solid #CACFD2">


<tr>
    <td style="text-align:center; align:center">
        <img src="http://localhost:4000/assets/files/article_10/ris.png" alt="" style="cursor: pointer;" onclick="openInNewTab('http://localhost:4000/assets/files/article_10/ris.png');" />
    </td>
</tr>
</table>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#define SYSCTL_RIS_R	(*((volatile unsigned long *)0x400FE050))
</span></code></pre>
</div>

<p>وما يهمنا في هذا السجل هو الحقل التالي:</p>
<ul>
  <li><strong>PLLLRIS</strong> (البت 6)
سوف نراقب هذا الحقل (الى أن يصبح قيمته 1) حتى نتأكد من إستقرار وإنتظام الـ PLL</li>
</ul>

<hr />

<h2><a href=""></a> تفعيل الـ PLL</h2>

<p>فيما يلي الخطوات المطلوبة لتفعيل البورد مع مذبذب رئيسي بتردد 16 ميجاهيرتز لتشغيل المتحكم بسرعة 80 ميجاهيرتز.</p>

<p><strong>1. استخدم RCC2 لأنه يوفر المزيد من الخيارات على RCC ويكون ذلك عن طريق إسناد 1 الى حقل USERCC2 (بت 31) في RCC2</strong></p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">SYSCTL_RCC2_R</span> <span class="o">|=</span>  <span class="mh">0x80000000</span><span class="p">;</span> <span class="c1">// 1000 0000 0000 0000 0000 0000 0000 0000  
</span></code></pre>
</div>

<p><strong>2. تجاوز مقسم ساعة PLL وساعة النظام عن طريق إسناد 1 الى حقل BYPASS2 (بت 11) في RCC2. عند هذه النقطة يتم تجاوز PLL ولا يوجد مقسم ساعة نظام.</strong></p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">SYSCTL_RCC2_R</span> <span class="o">|=</span>  <span class="mh">0x00000800</span><span class="p">;</span> <span class="c1">// 0000 0000 0000 0000 0000 1000 0000 0000
</span></code></pre>
</div>

<p><strong>3. تحديد تردد الكرستالة في حقل XTAL في RCC باستخدام القيّم في جدول XTAL السابق.</strong></p>

<p>بما أن الكرستالة التي على البورد تستخدم مذبذب بتردد 16 ميجاهيرتز فإننا، وحسب الجدول السابق، نقوم بضبط حقل XTAL ليحمل القيمة 0x15 أي 10101. ولو كانت الكرستالة بتردد مختلف، 24 ميجاهيرتز مثلاً، فسنضع القيمة 0x19 أي 11001 في حقل XTAL.</p>

<p>بما أن هذا الحقل يقع من البت 6 الى 10، فإن الرقم الست عشري hex الذي يفعّل جميع بتات هذا الحقل هو:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>0x000007C0 = 0000 0000 0000 0000 0000 0111 1100 0000
</code></pre>
</div>
<p>ولمسح القيمة الموجودة داخل هذا الحقل فإننا نعكس هذا الرقم:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>~(0x000007C0) = 1111 1111 1111 1111 1111 1000 0011 1111
</code></pre>
</div>

<p>وتصبح العملية بلغة الـ C كما يلي:</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">SYSCTL_RCC_R</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x000007C0</span><span class="p">;</span>
</code></pre>
</div>

<p>ولإسناد القيمة 0x15 أي 10101 والتي تمثل قيمة تردد الكرستالة 16 ميجاهيرتز فإنه يجب علينا أن نضع هذه القيمة في حقل XTAL والذي يقع بين البتات 6-10 من السجل RCC. ولذلك نستخدم العدد الست عشري التالي:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>0x00000540 = 0000 0000 0000 0000 0000 0000 0000 0101 0100 0000
</code></pre>
</div>

<p>وبإسناده الى SYSCTL_RCC_R يصبح لدينا:</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">SYSCTL_RCC_R</span> <span class="o">|=</span> <span class="mh">0x00000540</span><span class="p">;</span>
</code></pre>
</div>

<p><strong>4. يتم إسناد 0 الى حقل OSCSRC2 (بت 4-6) في RCC2 لتحديد المذبذب الرئيسي main oscillator كمصدر مذبذب للساعة.</strong></p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">SYSCTL_RCC2_R</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x00000070</span><span class="p">;</span> <span class="c1">// 1111 1111 1111 1111 1111 1111 1000 1111
</span></code></pre>
</div>

<p><strong>5. مسح PWRDN2 (بت 13) في RCC2 لتنشيط الـ PLL وتفعيله.</strong></p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">SYSCTL_RCC2_R</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x00002000</span><span class="p">;</span> <span class="c1">// 1111 1111 1111 1111 1101 1111 1111 1111
</span></code></pre>
</div>

<p><strong>6. إختيار الـ 400MHz PLL بدلاً من الـ 200MHz PLL عن طريق إسناد 1 الى حقل DIV400 (بت 30) في RCC2.</strong></p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">SYSCTL_RCC2_R</span> <span class="o">|=</span> <span class="mh">0x40000000</span><span class="p">;</span> <span class="c1">// 0100 0000 0000 0000 0000 0000 0000 0000
</span></code></pre>
</div>

<p><strong>7. تمكين مقسم الساعة باستخدام حقلي SYSDIV2 و SYSDIV2LSB (بت 22 الى 28) في RCC2.</strong></p>

<p>كما ذكرنا سابقاً، فإنه يتم الإستفادة من حقل SYSDIV2LSB كـ least significant bit لأننا أسندنا 1 الى DIV400.</p>

<p>نقوم أولاً بحذف القيمة الموجودة سابقاً في  SYSDIV2 و SYSDIV2LSB (بت 22 الى 28) في RCC2:</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">SYSCTL_RCC2_R</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x1FC00000</span><span class="p">;</span> <span class="c1">// 1110 0000 0011 1111 1111 1111 1111 1111
</span></code></pre>
</div>

<p>ثانياً، للحصول على تردد 80 ميجاهيرتز نحتاج إلى القسمة على 5. لذا، نقوم بوضع 4 في حقل SYSDIV2 و SYSDIV2LSB:</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">SYSCTL_RCC2_R</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">4</span><span class="o">&lt;&lt;</span><span class="mi">22</span><span class="p">);</span> <span class="c1">// 0000 0001 0000 0000 0000 0000 0000 0000
</span></code></pre>
</div>

<p><strong>8. بعد ذلك، ننتظر حتى يستقر وينتظم الـ PLL ﺑﻮاﺳﻄﺔ مراقبة PLLRIS (ﺒﺖ 6) ﻓﻲ RIS الى أن ﺗﺼﺒﺢ قيمتها 1.</strong></p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="c1">//    0x00000040 = 0000 0000 0000 0000 0000 0000 0100 0000
</span><span class="k">while</span><span class="p">((</span><span class="n">SYSCTL_RIS_R</span> <span class="o">&amp;</span> <span class="mh">0x00000040</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){};</span>
</code></pre>
</div>

<p><strong>9. الخطوة الأخيرة هي تمكين الـ PLL عن طريق مسح بت BYPASS2 (بت 11) في RCC2.</strong></p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">SYSCTL_RCC2_R</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x00000800</span><span class="p">;</span> <span class="c1">// 1111 1111 1111 1111 1111 0111 1111 1111
</span></code></pre>
</div>

<hr />

<h2><a href=""></a> الكود</h2>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#define SYSCTL_RIS_R      (*((volatile unsigned long *)0x400FE050))
#define SYSCTL_RCC_R      (*((volatile unsigned long *)0x400FE060))
#define SYSCTL_RCC2_R     (*((volatile unsigned long *)0x400FE070))
</span>  
<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 1) Use RCC2 for advanced features
</span>  <span class="c1">//    Set USERCC2 (bit 31) in RCC2
</span>  <span class="c1">//    0x80000000 = 1000 0000 0000 0000 0000 0000 0000 0000
</span>  <span class="n">SYSCTL_RCC2_R</span> <span class="o">|=</span>  <span class="mh">0x80000000</span><span class="p">;</span>
  
  <span class="c1">// 2) Bypass PLL while initializing
</span>  <span class="c1">//    Set BYPASS2 (bit 11) in RCC2
</span>  <span class="c1">//    0x00000800 = 0000 0000 0000 0000 0000 1000 0000 0000
</span>  <span class="n">SYSCTL_RCC2_R</span> <span class="o">|=</span>  <span class="mh">0x00000800</span><span class="p">;</span>
  
  <span class="c1">// 3) Select the crystal value and oscillator source
</span>  <span class="c1">// 3.a) Clear XTAL (bits 10-6) in RCC
</span>  <span class="c1">//       0x000007C0 = 0000 0000 0000 0000 0000 0111 1100 0000
</span>  <span class="c1">//      ~0x000007C0 = 1111 1111 1111 1111 1111 1000 0011 1111
</span>  <span class="n">SYSCTL_RCC_R</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x000007C0</span><span class="p">;</span>
  <span class="c1">// 3.b) Set XTAL (bits 10-6) in RCC to 0x15 (10101) for 16 MHz crystal
</span>  <span class="c1">//      0x00000540 = 0000 0000 0000 0000 0000 0101 0100 0000
</span>  <span class="n">SYSCTL_RCC_R</span> <span class="o">|=</span> <span class="mh">0x00000540</span><span class="p">;</span>
  
  <span class="c1">// 4) Configure for main oscillator source
</span>  <span class="c1">//    Set OSCSRC2 (bits 6-4) in RCC2 to 0 to select main oscillator
</span>  <span class="c1">//     0x00000070 = 0000 0000 0000 0000 0000 0000 0111 0000
</span>  <span class="c1">//    ~0x00000070 = 1111 1111 1111 1111 1111 1111 1000 1111
</span>  <span class="n">SYSCTL_RCC2_R</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x00000070</span><span class="p">;</span>
  
  <span class="c1">// 5) Activate PLL by clearing PWRDN2 (bit 13) in RCC2
</span>  <span class="c1">//     0x00002000 = 0000 0000 0000 0000 0010 0000 0000 0000
</span>  <span class="c1">//    ~0x00002000 = 1111 1111 1111 1111 1101 1111 1111 1111
</span>  <span class="n">SYSCTL_RCC2_R</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x00002000</span><span class="p">;</span>
  
  <span class="c1">// 6) Use 400 MHz PLL instead of 200 MHz PLL
</span>  <span class="c1">//    Set DIV400 (bit 30) in RCC2 to 1
</span>  <span class="c1">//    0x40000000 = 0100 0000 0000 0000 0000 0000 0000 0000
</span>  <span class="n">SYSCTL_RCC2_R</span> <span class="o">|=</span> <span class="mh">0x40000000</span><span class="p">;</span>   
  
  <span class="c1">// 7) Set the desired system divider and the system divider least significant bit
</span>  <span class="c1">// 7.a) Clear system clock divider and the system divider least significant bit
</span>  <span class="c1">//      Set SYSDIV2 (bits 28-23) in RCC2 to 0
</span>  <span class="c1">//      Set SYSDIV2LSB (bit 22) in RCC2 to 0
</span>  <span class="c1">//       0x1FC00000 = 0001 1111 1100 0000 0000 0000 0000 0000
</span>  <span class="c1">//      ~0x1FC00000 = 1110 0000 0011 1111 1111 1111 1111 1111
</span>  <span class="n">SYSCTL_RCC2_R</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x1FC00000</span><span class="p">;</span>
  <span class="c1">// 7.b) Configure for 80 MHz clock
</span>  <span class="c1">//      Set SYSDIV2 + SYSDIV2LSB (bits 28-22) in RCC2 to 4
</span>  <span class="c1">//      4&lt;&lt;22 = 0000 0001 0000 0000 0000 0000 0000 0000
</span>  <span class="n">SYSCTL_RCC2_R</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">4</span><span class="o">&lt;&lt;</span><span class="mi">22</span><span class="p">);</span>
                                    
  <span class="c1">// 8) Wait for the PLL to lock by polling PLLLRIS (bit 6) in RIS
</span>  <span class="c1">//    0x00000040 = 0000 0000 0000 0000 0000 0000 0100 0000
</span>  <span class="k">while</span><span class="p">((</span><span class="n">SYSCTL_RIS_R</span> <span class="o">&amp;</span> <span class="mh">0x00000040</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){};</span>
    
  <span class="c1">// 9) Enable use of PLL by clearing BYPASS2 (bit 11) in RCC2
</span>  <span class="c1">//    ~0x00000800 = 1111 1111 1111 1111 1111 0111 1111 1111
</span>  <span class="n">SYSCTL_RCC2_R</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x00000800</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre>
</div>

<hr />

<h3><a href=""></a> المراجع</h3>

<ol>
  <li>http://embedded-lab.com/blog/tiva-c-clock-system</li>
  <li>http://shukra.cedt.iisc.ernet.in/edwiki/EmSys:TM4C123_Using_PLL</li>
  <li>https://courses.edx.org/courses/course-v1:UTAustinX+UT.6.10x+2T2018</li>
</ol>

</p>

    <blockquote class="post_ending_note">
        <p><strong>ملاحظة</strong>: هذه المقالة تحت التحديث المستمر،، وملاحظاتكم وإقتراحاتكم ستساعد بإذن الله في إخراجها بالصورة التي كتبت من أجلها وهي تمهيد الطريق أمامكم لتعلم برمجة الأنظمة المدمجة </p>
    </blockquote>

    <hr>
      
          <a class="prev" href="/2018/07/06/uart.html">11. بروتوكول الإتصال الغير متزامن UART</a> <br>
      
      
          <a class="next" href="/2017/11/16/systick-timer.html">9. مؤقت النظام  SysTick Timer</a> <br>
      
    <br>
    <hr>

<br>




<div id="disqus_thread"></div>
<script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
this.page.url = "http://localhost:4000/2018/06/20/pll.html";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = "/2018/06/20/pll"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://embedded-course.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            


      </section>
<!--      
      <footer>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
-->
    </div>
    <script src="/assets/js/scale.fix.js"></script>
    <!--<script type="text/javascript" src="/assets/js/staticman.js"></script>-->

  
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-106571814-1', 'auto');
        ga('send', 'pageview');
    </script>
  
  </body>
</html>
